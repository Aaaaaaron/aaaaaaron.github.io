<!DOCTYPE html>
<html lang="">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="Parquet 乱弹">




  <meta name="keywords" content="Parquet,">





  <link rel="alternate" href="/default" title="Jiatao Tao's blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1">



<link rel="canonical" href="https://aaaaaaron.github.io/2019/05/09/Parquet-乱弹/">


<meta name="description" content="http://lvheyang.com/wp-content/uploads/2016/02/%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E4%B8%8EParquet%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E5%88%86%E4%BA%AB.pdf     recommended to set the parquet block s">
<meta name="keywords" content="Parquet">
<meta property="og:type" content="article">
<meta property="og:title" content="Parquet 乱弹">
<meta property="og:url" content="https://aaaaaaron.github.io/2019/05/09/Parquet-乱弹/index.html">
<meta property="og:site_name" content="Jiatao Tao&#39;s blog">
<meta property="og:description" content="http://lvheyang.com/wp-content/uploads/2016/02/%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E4%B8%8EParquet%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E5%88%86%E4%BA%AB.pdf     recommended to set the parquet block s">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509164025.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509165611.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509170805.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509182510.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528104542.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528104910.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528105205.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528105231.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528105342.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528105441.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528103634.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528103701.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528110659.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528110909.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528111155.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528103907.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528103951.png">
<meta property="og:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528104202.png">
<meta property="og:updated_time" content="2019-06-23T12:20:49.053Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Parquet 乱弹">
<meta name="twitter:description" content="http://lvheyang.com/wp-content/uploads/2016/02/%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E4%B8%8EParquet%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E5%88%86%E4%BA%AB.pdf     recommended to set the parquet block s">
<meta name="twitter:image" content="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509164025.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  





  


    <title> Parquet 乱弹 - Jiatao Tao's blog </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Jiatao Tao's blog</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/tags">
                            
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Parquet 乱弹
        
      </h1>

      <time class="post-time">
          May 9 2019
      </time>
    </header>



    
            <div class="post-content">
            <p><a href="http://lvheyang.com/wp-content/uploads/2016/02/%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E4%B8%8EParquet%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E5%88%86%E4%BA%AB.pdf" target="_blank" rel="noopener">http://lvheyang.com/wp-content/uploads/2016/02/%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8%E4%B8%8EParquet%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E5%88%86%E4%BA%AB.pdf</a></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509164025.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509165611.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509170805.png" alt=""></p>
<hr>
<p>recommended to set the parquet block size to match the MFS chunk size for optimal performance.  The default MFS chunk size is 256 MB. </p>
<p>A typical Hadoop job is IO bound, not CPU bound, so a light and fast compression codec will actually improve performance. </p>
<p>For MapReduce, if you need your compressed data to be splittable, BZip2 and LZO formats can be split. Snappy and GZip blocks are not splittable, but files with Snappy blocks inside a container file format such as SequenceFile or Avro can be split. </p>
<p>Compress Parquet files with Snappy they are indeed splittable, Property parquet.block.size defines Parquet file block size (row group size) and normally would be the same as HDFS block size. Snappy would compress Parquet row groups making Parquet file splittable.</p>
<p>The consequence of storing the metadata in the footer is that reading a Parquet file requires an initial seek to the end of the file (minus 8 bytes) to read the footer metadata length, then a second seek backward by that length to read the footer metadata. Unlike sequence files and Avro datafiles, where the metadata is stored in the header and sync markers are used to separate blocks, Parquet files don’t need sync markers since the block boundaries are stored in the footer metadata. (This is possible because the metadata is written after all the blocks have been written, so the writer can retain the block boundary positions in memory until the file is closed.) Therefore, Parquet files are splittable, since the blocks can be located after reading the footer and can then be processed in parallel (by MapReduce, for example).</p>
<hr>
<p>parquet tool<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">usage: parquet-tools cat [option...] &lt;input&gt;</span><br><span class="line">usage: parquet-tools head [option...] &lt;input&gt;</span><br><span class="line">usage: parquet-tools schema [option...] &lt;input&gt;</span><br><span class="line">usage: parquet-tools meta [option...] &lt;input&gt;</span><br><span class="line">usage: parquet-tools dump [option...] &lt;input&gt;</span><br><span class="line">usage: parquet-tools merge [option...] &lt;input&gt; [&lt;input&gt; ...] &lt;output&gt;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>for spark:<br><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190509182510.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testParquetRead</span><span class="params">(<span class="keyword">double</span>[] data, CompressionCodecName compress)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">    List&lt;Type&gt; fields = Lists.newArrayList();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        fields.add(<span class="keyword">new</span> PrimitiveType(Type.Repetition.REQUIRED, PrimitiveType.PrimitiveTypeName.DOUBLE, <span class="string">"f"</span> + i));</span><br><span class="line">    &#125;</span><br><span class="line">    MessageType schema = <span class="keyword">new</span> MessageType(<span class="string">"ori"</span>, fields);</span><br><span class="line"></span><br><span class="line">    writeFile(conf, schema, data, compress);</span><br><span class="line">    testRowGroupRead(conf, schema);</span><br><span class="line">    testSimpleRead(conf, data.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeFile</span><span class="params">(Configuration conf, MessageType schema, <span class="keyword">double</span>[] data, CompressionCodecName compress)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    GroupWriteSupport.setSchema(schema, conf);</span><br><span class="line">    ParquetWriter&lt;Group&gt; writer = <span class="keyword">new</span> ParquetWriter&lt;&gt;(path, <span class="keyword">new</span> GroupWriteSupport(), compress, <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">            <span class="number">1024</span> * <span class="number">1024</span>, <span class="number">1048576</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, PARQUET_2_0, conf);</span><br><span class="line"></span><br><span class="line">    SimpleGroupFactory simpleGroupFactory = <span class="keyword">new</span> SimpleGroupFactory(schema);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">double</span> v : data) &#123;</span><br><span class="line">        writer.write(simpleGroupFactory.newGroup().append(<span class="string">"f0"</span>, v).append(<span class="string">"f1"</span>, v).append(<span class="string">"f2"</span>, v));</span><br><span class="line">    &#125;</span><br><span class="line">    writer.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testRowGroupRead</span><span class="params">(Configuration conf, MessageType messageType)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ParquetMetadata footer = ParquetFileReader.readFooter(conf, path, ParquetMetadataConverter.NO_FILTER);</span><br><span class="line">    ParquetFileReader parquetFileReader = <span class="keyword">new</span> ParquetFileReader(conf, footer.getFileMetaData(), path,</span><br><span class="line">            footer.getBlocks(), messageType.getColumns());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> t = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">int</span> totalRowCount = <span class="number">0</span>;</span><br><span class="line">    PageReadStore pageReadStore = parquetFileReader.readNextRowGroup();</span><br><span class="line">    <span class="keyword">while</span> (pageReadStore != <span class="keyword">null</span>) &#123;</span><br><span class="line">        totalRowCount += pageReadStore.getRowCount();</span><br><span class="line">        <span class="keyword">for</span> (ColumnDescriptor columnDescriptor : footer.getFileMetaData().getSchema().getColumns()) &#123;</span><br><span class="line">            pageReadStore.getPageReader(columnDescriptor).readPage();</span><br><span class="line">        &#125;</span><br><span class="line">        pageReadStore = parquetFileReader.readNextRowGroup();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"Row Group read style take:"</span> + (System.currentTimeMillis() - t));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testSimpleRead</span><span class="params">(Configuration conf, <span class="keyword">int</span> n)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ParquetReader&lt;Group&gt; reader = ParquetReader.builder(<span class="keyword">new</span> GroupReadSupport(), path).withConf(conf).build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> t = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        Group group = reader.read();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">            group.getDouble(<span class="string">"m"</span> + j, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"Simple read take:"</span> + (System.currentTimeMillis() - t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="page"><a href="#page" class="headerlink" title="page"></a>page</h3><p>read : int rowGroup, int column, long offset<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ParquetMetadata parquetMetadata = ParquetFileReader.readFooter(config, path, ParquetMetadataConverter.NO_FILTER)</span><br><span class="line">BlockMetaData blockMetaData = parquetMetadata.getBlocks().get(rowGroup);</span><br><span class="line">ColumnChunkMetaData columnChunkMetaData = blockMetaData.getColumns().get(column);</span><br><span class="line">ColumnDescriptor columnDescriptor = parquetMetadata.getFileMetaData().getSchema().getColumns().get(column)</span><br><span class="line">inputStream.seek(offset);</span><br><span class="line">PageHeader pageHeader = Util.readPageHeader(inputStream);</span><br><span class="line">DataPageHeader dataPageHeader = pageHeader.getData_page_header();</span><br><span class="line"><span class="keyword">int</span> numValues = dataPageHeader.getNum_values();</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ColumnChunkPageReader <span class="title">readAllPages</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  List&lt;DataPage&gt; pagesInChunk = <span class="keyword">new</span> ArrayList&lt;DataPage&gt;();</span><br><span class="line">  DictionaryPage dictionaryPage = <span class="keyword">null</span>;</span><br><span class="line">  PrimitiveType type = getFileMetaData().getSchema()</span><br><span class="line">      .getType(descriptor.col.getPath()).asPrimitiveType();</span><br><span class="line">  <span class="keyword">long</span> valuesCountReadSoFar = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> dataPageCountReadSoFar = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (hasMorePages(valuesCountReadSoFar, dataPageCountReadSoFar)) &#123;</span><br><span class="line">    PageHeader pageHeader = readPageHeader();</span><br><span class="line">    <span class="keyword">int</span> uncompressedPageSize = pageHeader.getUncompressed_page_size();</span><br><span class="line">    <span class="keyword">int</span> compressedPageSize = pageHeader.getCompressed_page_size();</span><br><span class="line">    <span class="keyword">switch</span> (pageHeader.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> DICTIONARY_PAGE:</span><br><span class="line">        <span class="comment">// there is only one dictionary page per column chunk</span></span><br><span class="line">        <span class="keyword">if</span> (dictionaryPage != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> ParquetDecodingException(<span class="string">"more than one dictionary page in column "</span> + descriptor.col);</span><br><span class="line">        &#125;</span><br><span class="line">        DictionaryPageHeader dicHeader = pageHeader.getDictionary_page_header();</span><br><span class="line">        dictionaryPage =</span><br><span class="line">            <span class="keyword">new</span> DictionaryPage(</span><br><span class="line">                <span class="keyword">this</span>.readAsBytesInput(compressedPageSize),</span><br><span class="line">                uncompressedPageSize,</span><br><span class="line">                dicHeader.getNum_values(),</span><br><span class="line">                converter.getEncoding(dicHeader.getEncoding())</span><br><span class="line">                );</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> DATA_PAGE:</span><br><span class="line">        DataPageHeader dataHeaderV1 = pageHeader.getData_page_header();</span><br><span class="line">        pagesInChunk.add(</span><br><span class="line">            <span class="keyword">new</span> DataPageV1(</span><br><span class="line">                <span class="keyword">this</span>.readAsBytesInput(compressedPageSize),</span><br><span class="line">                dataHeaderV1.getNum_values(),</span><br><span class="line">                uncompressedPageSize,</span><br><span class="line">                converter.fromParquetStatistics(</span><br><span class="line">                    getFileMetaData().getCreatedBy(),</span><br><span class="line">                    dataHeaderV1.getStatistics(),</span><br><span class="line">                    type),</span><br><span class="line">                converter.getEncoding(dataHeaderV1.getRepetition_level_encoding()),</span><br><span class="line">                converter.getEncoding(dataHeaderV1.getDefinition_level_encoding()),</span><br><span class="line">                converter.getEncoding(dataHeaderV1.getEncoding())</span><br><span class="line">                ));</span><br><span class="line">        valuesCountReadSoFar += dataHeaderV1.getNum_values();</span><br><span class="line">        ++dataPageCountReadSoFar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> DATA_PAGE_V2:</span><br><span class="line">        DataPageHeaderV2 dataHeaderV2 = pageHeader.getData_page_header_v2();</span><br><span class="line">        <span class="keyword">int</span> dataSize = compressedPageSize - dataHeaderV2.getRepetition_levels_byte_length() - dataHeaderV2.getDefinition_levels_byte_length();</span><br><span class="line">        pagesInChunk.add(</span><br><span class="line">            <span class="keyword">new</span> DataPageV2(</span><br><span class="line">                dataHeaderV2.getNum_rows(),</span><br><span class="line">                dataHeaderV2.getNum_nulls(),</span><br><span class="line">                dataHeaderV2.getNum_values(),</span><br><span class="line">                <span class="keyword">this</span>.readAsBytesInput(dataHeaderV2.getRepetition_levels_byte_length()),</span><br><span class="line">                <span class="keyword">this</span>.readAsBytesInput(dataHeaderV2.getDefinition_levels_byte_length()),</span><br><span class="line">                converter.getEncoding(dataHeaderV2.getEncoding()),</span><br><span class="line">                <span class="keyword">this</span>.readAsBytesInput(dataSize),</span><br><span class="line">                uncompressedPageSize,</span><br><span class="line">                converter.fromParquetStatistics(</span><br><span class="line">                    getFileMetaData().getCreatedBy(),</span><br><span class="line">                    dataHeaderV2.getStatistics(),</span><br><span class="line">                    type),</span><br><span class="line">                dataHeaderV2.isIs_compressed()</span><br><span class="line">                ));</span><br><span class="line">        valuesCountReadSoFar += dataHeaderV2.getNum_values();</span><br><span class="line">        ++dataPageCountReadSoFar;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        LOG.debug(<span class="string">"skipping page of type &#123;&#125; of size &#123;&#125;"</span>, pageHeader.getType(), compressedPageSize);</span><br><span class="line">        stream.skipFully(compressedPageSize);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (offsetIndex == <span class="keyword">null</span> &amp;&amp; valuesCountReadSoFar != descriptor.metadata.getValueCount()) &#123;</span><br><span class="line">    <span class="comment">// Would be nice to have a CorruptParquetFileException or something as a subclass?</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IOException(</span><br><span class="line">        <span class="string">"Expected "</span> + descriptor.metadata.getValueCount() + <span class="string">" values in column chunk at "</span> +</span><br><span class="line">        getPath() + <span class="string">" offset "</span> + descriptor.metadata.getFirstDataPageOffset() +</span><br><span class="line">        <span class="string">" but got "</span> + valuesCountReadSoFar + <span class="string">" values instead over "</span> + pagesInChunk.size()</span><br><span class="line">        + <span class="string">" pages ending at file offset "</span> + (descriptor.fileOffset + stream.position()));</span><br><span class="line">  &#125;</span><br><span class="line">  BytesInputDecompressor decompressor = options.getCodecFactory().getDecompressor(descriptor.metadata.getCodec());</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ColumnChunkPageReader(decompressor, pagesInChunk, dictionaryPage, offsetIndex,</span><br><span class="line">      blocks.get(currentBlock).getRowCount());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<hr>
<h1 id="读"><a href="#读" class="headerlink" title="读"></a>读</h1><h2 id="原生-parquet"><a href="#原生-parquet" class="headerlink" title="原生 parquet"></a>原生 parquet</h2><p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528104542.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528104910.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528105205.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528105231.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528105342.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528105441.png" alt=""></p>
<hr>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528103634.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528103701.png" alt=""></p>
<p>ColumnChunkPageReadStore(RowGroupImpl)<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">public <span class="type">DataPage</span> readPage() &#123;</span><br><span class="line">  <span class="keyword">if</span> (compressedPages.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">DataPage</span> compressedPage = compressedPages.remove(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">final</span> int currentPageIndex = pageIndex++;</span><br><span class="line">  <span class="keyword">return</span> compressedPage.accept(<span class="keyword">new</span> <span class="type">DataPage</span>.<span class="type">Visitor</span>&lt;<span class="type">DataPage</span>&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public <span class="type">DataPage</span> visit(<span class="type">DataPageV1</span> dataPageV1) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">BytesInput</span> decompressed = decompressor.decompress(dataPageV1.getBytes(), dataPageV1.getUncompressedSize());</span><br><span class="line">        <span class="keyword">if</span> (offsetIndex == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">DataPageV1</span>(</span><br><span class="line">              decompressed,</span><br><span class="line">              dataPageV1.getValueCount(),</span><br><span class="line">              dataPageV1.getUncompressedSize(),</span><br><span class="line">              dataPageV1.getStatistics(),</span><br><span class="line">              dataPageV1.getRlEncoding(),</span><br><span class="line">              dataPageV1.getDlEncoding(),</span><br><span class="line">              dataPageV1.getValueEncoding());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          long firstRowIndex = offsetIndex.getFirstRowIndex(currentPageIndex);</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">DataPageV1</span>(</span><br><span class="line">              decompressed,</span><br><span class="line">              dataPageV1.getValueCount(),</span><br><span class="line">              dataPageV1.getUncompressedSize(),</span><br><span class="line">              firstRowIndex,</span><br><span class="line">              <span class="type">Math</span>.toIntExact(offsetIndex.getLastRowIndex(currentPageIndex, rowCount) - firstRowIndex + <span class="number">1</span>),</span><br><span class="line">              dataPageV1.getStatistics(),</span><br><span class="line">              dataPageV1.getRlEncoding(),</span><br><span class="line">              dataPageV1.getDlEncoding(),</span><br><span class="line">              dataPageV1.getValueEncoding());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (<span class="type">IOException</span> e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">ParquetDecodingException</span>(<span class="string">"could not decompress page"</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public <span class="type">DataPage</span> visit(<span class="type">DataPageV2</span> dataPageV2) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!dataPageV2.isCompressed()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (offsetIndex == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> dataPageV2;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="type">DataPageV2</span>.uncompressed(</span><br><span class="line">              dataPageV2.getRowCount(),</span><br><span class="line">              dataPageV2.getNullCount(),</span><br><span class="line">              dataPageV2.getValueCount(),</span><br><span class="line">              offsetIndex.getFirstRowIndex(currentPageIndex),</span><br><span class="line">              dataPageV2.getRepetitionLevels(),</span><br><span class="line">              dataPageV2.getDefinitionLevels(),</span><br><span class="line">              dataPageV2.getDataEncoding(),</span><br><span class="line">              dataPageV2.getData(),</span><br><span class="line">              dataPageV2.getStatistics());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        int uncompressedSize = <span class="type">Math</span>.toIntExact(</span><br><span class="line">            dataPageV2.getUncompressedSize()</span><br><span class="line">                - dataPageV2.getDefinitionLevels().size()</span><br><span class="line">                - dataPageV2.getRepetitionLevels().size());</span><br><span class="line">        <span class="type">BytesInput</span> decompressed = decompressor.decompress(dataPageV2.getData(), uncompressedSize);</span><br><span class="line">        <span class="keyword">if</span> (offsetIndex == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="type">DataPageV2</span>.uncompressed(</span><br><span class="line">              dataPageV2.getRowCount(),</span><br><span class="line">              dataPageV2.getNullCount(),</span><br><span class="line">              dataPageV2.getValueCount(),</span><br><span class="line">              dataPageV2.getRepetitionLevels(),</span><br><span class="line">              dataPageV2.getDefinitionLevels(),</span><br><span class="line">              dataPageV2.getDataEncoding(),</span><br><span class="line">              decompressed,</span><br><span class="line">              dataPageV2.getStatistics());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="type">DataPageV2</span>.uncompressed(</span><br><span class="line">              dataPageV2.getRowCount(),</span><br><span class="line">              dataPageV2.getNullCount(),</span><br><span class="line">              dataPageV2.getValueCount(),</span><br><span class="line">              offsetIndex.getFirstRowIndex(currentPageIndex),</span><br><span class="line">              dataPageV2.getRepetitionLevels(),</span><br><span class="line">              dataPageV2.getDefinitionLevels(),</span><br><span class="line">              dataPageV2.getDataEncoding(),</span><br><span class="line">              decompressed,</span><br><span class="line">              dataPageV2.getStatistics());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (<span class="type">IOException</span> e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">ParquetDecodingException</span>(<span class="string">"could not decompress page"</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="spark"><a href="#spark" class="headerlink" title="spark"></a>spark</h2><p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528110659.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528110909.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528111155.png" alt=""></p>
<p><strong>spark 读的调用栈</strong><br><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528103907.png" alt=""></p>
<p><strong>Vectorized read</strong><br><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528103951.png" alt=""></p>
<p><img src="https://aron-blog-1257818292.cos.ap-shanghai.myqcloud.com/20190528104202.png" alt=""></p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Reads `total` values from this columnReader into column.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">void readBatch(int total, <span class="type">WritableColumnVector</span> column) <span class="keyword">throws</span> <span class="type">IOException</span> &#123;</span><br><span class="line">  int rowId = <span class="number">0</span>;</span><br><span class="line">  <span class="type">WritableColumnVector</span> dictionaryIds = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">if</span> (dictionary != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// SPARK-16334: We only maintain a single dictionary per row batch, so that it can be used to</span></span><br><span class="line">    <span class="comment">// decode all previous dictionary encoded pages if we ever encounter a non-dictionary encoded</span></span><br><span class="line">    <span class="comment">// page.</span></span><br><span class="line">    dictionaryIds = column.reserveDictionaryIds(total);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (total &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Compute the number of values we want to read in this page.</span></span><br><span class="line">    int leftInPage = (int) (endOfPageValueCount - valuesRead);</span><br><span class="line">    <span class="keyword">if</span> (leftInPage == <span class="number">0</span>) &#123;</span><br><span class="line">      readPage();</span><br><span class="line">      leftInPage = (int) (endOfPageValueCount - valuesRead);</span><br><span class="line">    &#125;</span><br><span class="line">    int num = <span class="type">Math</span>.min(total, leftInPage);</span><br><span class="line">    <span class="type">PrimitiveType</span>.<span class="type">PrimitiveTypeName</span> typeName =</span><br><span class="line">      descriptor.getPrimitiveType().getPrimitiveTypeName();</span><br><span class="line">    <span class="keyword">if</span> (isCurrentPageDictionaryEncoded) &#123;</span><br><span class="line">      <span class="comment">// Read and decode dictionary ids.</span></span><br><span class="line">      defColumn.readIntegers(</span><br><span class="line">          num, dictionaryIds, column, rowId, maxDefLevel, (<span class="type">VectorizedValuesReader</span>) dataColumn);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// TIMESTAMP_MILLIS encoded as INT64 can't be lazily decoded as we need to post process</span></span><br><span class="line">      <span class="comment">// the values to add microseconds precision.</span></span><br><span class="line">      <span class="keyword">if</span> (column.hasDictionary() || (rowId == <span class="number">0</span> &amp;&amp;</span><br><span class="line">          (typeName == <span class="type">PrimitiveType</span>.<span class="type">PrimitiveTypeName</span>.<span class="type">INT32</span> ||</span><br><span class="line">          (typeName == <span class="type">PrimitiveType</span>.<span class="type">PrimitiveTypeName</span>.<span class="type">INT64</span> &amp;&amp;</span><br><span class="line">            originalType != <span class="type">OriginalType</span>.<span class="type">TIMESTAMP_MILLIS</span>) ||</span><br><span class="line">          typeName == <span class="type">PrimitiveType</span>.<span class="type">PrimitiveTypeName</span>.<span class="type">FLOAT</span> ||</span><br><span class="line">          typeName == <span class="type">PrimitiveType</span>.<span class="type">PrimitiveTypeName</span>.<span class="type">DOUBLE</span> ||</span><br><span class="line">          typeName == <span class="type">PrimitiveType</span>.<span class="type">PrimitiveTypeName</span>.<span class="type">BINARY</span>))) &#123;</span><br><span class="line">        <span class="comment">// Column vector supports lazy decoding of dictionary values so just set the dictionary.</span></span><br><span class="line">        <span class="comment">// We can't do this if rowId != 0 AND the column doesn't have a dictionary (i.e. some</span></span><br><span class="line">        <span class="comment">// non-dictionary encoded values have already been added).</span></span><br><span class="line">        column.setDictionary(<span class="keyword">new</span> <span class="type">ParquetDictionary</span>(dictionary));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        decodeDictionaryIds(rowId, num, column, dictionaryIds);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (column.hasDictionary() &amp;&amp; rowId != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// This batch already has dictionary encoded values but this new page is not. The batch</span></span><br><span class="line">        <span class="comment">// does not support a mix of dictionary and not so we will decode the dictionary.</span></span><br><span class="line">        decodeDictionaryIds(<span class="number">0</span>, rowId, column, column.getDictionaryIds());</span><br><span class="line">      &#125;</span><br><span class="line">      column.setDictionary(<span class="literal">null</span>);</span><br><span class="line">      switch (typeName) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">BOOLEAN</span>:</span><br><span class="line">          readBooleanBatch(rowId, num, column);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">INT32</span>:</span><br><span class="line">          readIntBatch(rowId, num, column);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">INT64</span>:</span><br><span class="line">          readLongBatch(rowId, num, column);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">INT96</span>:</span><br><span class="line">          readBinaryBatch(rowId, num, column);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">FLOAT</span>:</span><br><span class="line">          readFloatBatch(rowId, num, column);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">DOUBLE</span>:</span><br><span class="line">          readDoubleBatch(rowId, num, column);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">BINARY</span>:</span><br><span class="line">          readBinaryBatch(rowId, num, column);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">FIXED_LEN_BYTE_ARRAY</span>:</span><br><span class="line">          readFixedLenByteArrayBatch(</span><br><span class="line">            rowId, num, column, descriptor.getPrimitiveType().getTypeLength());</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IOException</span>(<span class="string">"Unsupported type: "</span> + typeName);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    valuesRead += num;</span><br><span class="line">    rowId += num;</span><br><span class="line">    total -= num;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
            </div>
          

    
      <footer class="post-footer">
        <div class="post-tags">
          
            <a href="/tags/Parquet/">Parquet</a>
          
        </div>

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2019/06/29/Spark-SQL-Join-Deep-Dive/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Spark SQL Join Deep Dive</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2019/01/26/Spark-Scheduler-Deep-Dive/">
        <span class="next-text nav-default">Spark Scheduler Deep Dive</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2012 -
    
    2019
    <span class="footer-author">陶加涛.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/henryhuang/hexo-theme-polarbearsimple">Polar Bear Simple</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
